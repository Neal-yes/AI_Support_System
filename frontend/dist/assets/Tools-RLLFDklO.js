import{d as Wt,r as p,c as y,w as et,o as Le,a as Xt,b as u,e as n,g as d,h as f,j as C,l as Zt,t as a,n as O,k as E,F as V,p as K,v as el,q as ye,s as tt,m as r,_ as tl}from"./index-esQvTIoC.js";import{a as me}from"./index-NIGUFBhG.js";function lt(ge){return ge?/^https?:\/\//i.test(ge):!1}const fe={},ll={class:"card"},nl={class:"row"},ol={key:0},sl={key:0,class:"warn"},al={key:1},ul={class:"row"},rl={class:"row",style:{gap:"8px","align-items":"center","flex-wrap":"wrap"}},il={class:"obs-conf"},pl={key:0,style:{color:"#c62828","font-size":"12px","margin-left":"6px"}},dl={class:"obs-conf"},vl={key:0,style:{color:"#c62828","font-size":"12px","margin-left":"6px"}},cl={class:"row",style:{"margin-top":"6px",gap:"8px","align-items":"center","flex-wrap":"wrap"}},yl={class:"row",style:{"margin-top":"6px",gap:"8px","align-items":"center","flex-wrap":"wrap"}},ml=["disabled","title"],fl=["disabled","title"],bl={class:"obs-conf",style:{"margin-top":"6px"}},gl={style:{"white-space":"pre-wrap"}},kl={class:"obs-conf",style:{"margin-top":"6px"}},hl={style:{"white-space":"pre-wrap"}},_l=["onUpdate:modelValue"],Ol=["data-type"],wl={style:{"margin-left":"8px"}},Sl=["disabled"],xl=["disabled"],Cl=["disabled"],Nl=["disabled"],Tl={key:2,style:{"margin-top":"6px"}},$l={class:"layers-table"},Jl={key:0,class:"sort"},Bl={key:0},Ll={key:1},Ul={key:2},jl={key:3},ql={key:4},El={key:0,class:"sort"},Vl={key:0,class:"sort"},Rl={key:0,class:"sort"},Pl={"aria-hidden":"true",style:{height:"0"}},Ml=["colspan"],Al={class:"col-key"},Il={class:"key-cell"},Dl=["data-type"],Ql={key:0},Hl={key:1},Gl={key:2},zl={key:3},Kl={key:4},Fl={class:"col-merged"},Yl={class:"merged-cell"},Wl={class:"type-badge"},Xl=["onClick"],Zl=["onClick"],en={key:0,class:"expanded-json"},tn=["data-src"],ln=["onClick","disabled"],nn=["onClick","disabled"],on={"aria-hidden":"true",style:{height:"0"}},sn=["colspan"],an={key:1,class:"layers-table"},un={key:0,class:"sort"},rn={key:0},pn={key:1},dn={key:2},vn={key:3},cn={key:4},yn={key:0,class:"sort"},mn={key:0,class:"sort"},fn={key:0,class:"sort"},bn={class:"col-key"},gn={class:"key-cell"},kn=["data-type"],hn={key:0},_n={key:1},On={key:2},wn={key:3},Sn={key:4},xn={class:"col-merged"},Cn={class:"merged-cell"},Nn={class:"type-badge"},Tn=["onClick"],$n=["onClick"],Jn={key:0,class:"expanded-json"},Bn=["data-src"],Ln=["onClick","disabled"],Un=["onClick","disabled"],jn={key:4},qn=["onClick"],Ue="toolsObsConf",nt=1024*1024,be=38,ot=8,En=Wt({__name:"Tools",setup(ge){const L=p("default"),_=p("http_get"),w=p("simple"),b=p('{"url":"https://example.com"}'),k=p('{"timeout_ms":2000, "allow_hosts":["example.com"], "deny_hosts":[]}'),F=p(""),Y=p(void 0),M=p(void 0),A=p({}),R=p(""),ke=p(""),he=p(""),je=p(""),j=p({}),W=p({});function st(){try{const l=localStorage.getItem(Ue);if(!l){Se&&(c.value=Se),xe&&(T.value=xe),Ce&&(m.value=Ce),Ne&&($.value=Ne);return}const e=JSON.parse(l);typeof e?.promBase=="string"&&(c.value=e.promBase),typeof e?.promQueryTpl=="string"&&e.promQueryTpl&&(T.value=e.promQueryTpl),typeof e?.logsBase=="string"&&(m.value=e.logsBase),typeof e?.logsQueryTpl=="string"&&e.logsQueryTpl&&($.value=e.logsQueryTpl)}catch{}}function qe(){try{const l={promBase:c.value,promQueryTpl:T.value,logsBase:m.value,logsQueryTpl:$.value};localStorage.setItem(Ue,JSON.stringify(l))}catch{}}function at(){try{localStorage.removeItem(Ue)}catch{}c.value=Se||"",T.value=xe||'sum(rate(tool_invocations_total{tenant="$tenant",tool_type="$type",tool_name="$name",option_key="$key"}[5m]))',m.value=Ce||"",$.value=Ne||'key:"$key" AND tenant:"$tenant" AND tool:"$type.$name"'}function ut(){try{const l={promBase:c.value,promQueryTpl:T.value,logsBase:m.value,logsQueryTpl:$.value,version:1,exportedAt:new Date().toISOString()},e=new Blob([JSON.stringify(l,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),o=document.createElement("a");o.href=t,o.download="toolsObsConf.json",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t)}catch{}}function rt(){Ae.value?.click()}function it(l){const e=l.target,t=e.files&&e.files[0];if(!t)return;if(t.size>nt){alert(`导入配置失败：文件过大（${Math.ceil(t.size/1024)}KB），上限为 ${Math.ceil(nt/1024)}KB`),e.value="";return}const o=new FileReader;o.onload=()=>{try{const v=String(o.result||""),s=JSON.parse(v);s&&typeof s=="object"&&(typeof s.promBase=="string"&&(c.value=s.promBase),typeof s.promQueryTpl=="string"&&s.promQueryTpl&&(T.value=s.promQueryTpl),typeof s.logsBase=="string"&&(m.value=s.logsBase),typeof s.logsQueryTpl=="string"&&s.logsQueryTpl&&($.value=s.logsQueryTpl),qe())}catch(v){const s=v?.message||"JSON 解析错误";alert("导入配置失败："+s)}finally{e.value=""}},o.readAsText(t)}const _e=p([]),i=p({global:!0,tenant:!0,type:!0,name:!0,request:!0}),I=p(new Set),D=p(null),Ee=p(240),pt=y(()=>`${Ee.value}px`),X=p(!1),se=p(420),dt=p(null),Ve=p(0),vt=y(()=>Math.max(1,Math.ceil(se.value/be)+ot)),Oe=y(()=>Math.max(0,Math.floor(Ve.value/be)-Math.floor(ot/2))),Re=y(()=>Math.min(P.value.length,Oe.value+vt.value)),ct=y(()=>P.value.slice(Oe.value,Re.value)),yt=y(()=>Oe.value*be),mt=y(()=>Math.max(0,(P.value.length-Re.value)*be)),Pe=y(()=>1+(i.value.global?1:0)+(i.value.tenant?1:0)+(i.value.type?1:0)+(i.value.name?1:0)+(i.value.request?1:0)+4);function ft(l){const e=l.target;Ve.value=e.scrollTop}const ae=p(""),ue=p(!1),bt=["allow","deny","timeout","rate","retry","circuit","cache","resp"],re=p({allow:!1,deny:!1,timeout:!1,rate:!1,retry:!1,circuit:!1,cache:!1,resp:!1}),Q=y(()=>{const l=(ae.value||"").toLowerCase().trim(),e=Object.keys(re.value).filter(t=>re.value[t]);return _e.value.filter(t=>{const o=!l||t.key.toLowerCase().includes(l),v=!ue.value||t.overridden,s=Be(t.key),h=e.length===0||e.some(x=>s.includes(x));return o&&v&&h})}),S=p(1),Z=p(50),ee=y(()=>Math.max(1,Math.ceil(Q.value.length/Z.value))),we=y(()=>Math.min((S.value-1)*Z.value,Math.max(0,Q.value.length-1))),Me=y(()=>Math.min(we.value+Z.value,Q.value.length));et([ae,ue],()=>{S.value=1});const B=p("key"),N=p(!0),te=p(""),P=y(()=>{const l=[...Q.value],e=B.value;return l.sort((t,o)=>{let v,s;e==="overridden"?(v=t.overridden?1:0,s=o.overridden?1:0):e==="merged"&&te.value.trim()?(v=Ze(t,te.value.trim()),s=Ze(o,te.value.trim())):(v=t[e],s=o[e]);const h=Number(v),x=Number(s);let J;return!Number.isNaN(h)&&!Number.isNaN(x)?J=h-x:J=String(v).localeCompare(String(s)),N.value?J:-J}),l});function q(l){B.value===l?N.value=!N.value:(B.value=l,N.value=!0)}const gt=y(()=>X.value?P.value:P.value.slice(we.value,Me.value));function kt(){S.value=1}function ht(){S.value>1&&(S.value-=1)}function _t(){S.value<ee.value&&(S.value+=1)}function Ot(){S.value=ee.value}const le=p([]),c=p(""),T=p('sum(rate(tool_invocations_total{tenant="$tenant",tool_type="$type",tool_name="$name",option_key="$key"}[5m]))'),m=p(""),$=p('key:"$key" AND tenant:"$tenant" AND tool:"$type.$name"'),Ae=p(null),Se=fe?.VITE_OBS_PROM_BASE||"",xe=fe?.VITE_OBS_PROM_QUERY_TPL||"",Ce=fe?.VITE_OBS_LOGS_BASE||"",Ne=fe?.VITE_OBS_LOGS_QUERY_TPL||"",U=p("");function Ie(l,e){try{return l.replace(/\$tenant/g,L.value).replace(/\$type/g,_.value).replace(/\$name/g,w.value).replace(/\$key/g,e)}catch{return l}}const De=y(()=>{const l=(U.value||"").trim();return!l||!T.value?"":Ie(T.value,l)}),Qe=y(()=>{const l=(U.value||"").trim();return!l||!$.value?"":Ie($.value,l)});function He(l,e){return l.replace(/\$tenant/g,L.value).replace(/\$type/g,_.value).replace(/\$name/g,w.value).replace(/\$key/g,e.key)}function ie(l,e){try{if(e==="metrics"){if(!c.value)return;const t=He(T.value||"",l),o=/\/graph(\b|$)/.test(c.value),v=c.value+(c.value.includes("?")?"&":"?")+(o?"g0.expr=":"query=")+encodeURIComponent(t);window.open(v,"_blank")}else{if(!m.value)return;const t=He($.value||"",l),o=m.value+(m.value.includes("?")?"&":"?")+"q="+encodeURIComponent(t);window.open(o,"_blank")}}catch{}}function Ge(l){try{if(!(U.value||"").trim())return;if(l==="metrics"){if(!c.value||!pe.value){alert("Prom 基地址为空或格式无效（需以 http/https 开头）");return}const t=De.value;if(!t)return;const o=/\/graph(\b|$)/.test(c.value),v=c.value+(c.value.includes("?")?"&":"?")+(o?"g0.expr=":"query=")+encodeURIComponent(t);window.open(v,"_blank")}else{if(!m.value||!de.value){alert("日志基地址为空或格式无效（需以 http/https 开头）");return}const t=Qe.value;if(!t)return;const o=m.value+(m.value.includes("?")?"&":"?")+"q="+encodeURIComponent(t);window.open(o,"_blank")}}catch{}}const pe=y(()=>!c.value||lt(c.value)),de=y(()=>!m.value||lt(m.value)),wt=y(()=>!U.value||!c.value||!pe.value),St=y(()=>!U.value||!m.value||!de.value),xt=y(()=>U.value?c.value?pe.value?"":"Prom 基地址需以 http/https 开头":"请填写 Prom 基地址":"请输入测试键名"),Ct=y(()=>U.value?m.value?de.value?"":"日志基地址需以 http/https 开头":"请填写日志基地址":"请输入测试键名"),Te=y(()=>{try{const l=JSON.parse(b.value||"{}"),e=JSON.parse(k.value||"{}"),t={tenant_id:L.value,tool_type:_.value,tool_name:w.value,params:l,options:e};return JSON.stringify(t,null,2)}catch(l){return"JSON 解析错误: "+(l?.message||String(l))}}),ze=y(()=>{try{const l=Te.value;return l.startsWith("JSON 解析错误")?l:`curl -sS -X POST -H 'Content-Type: application/json' --data '${l.replace(/'/g,"'\\''")}' ${window.location.origin}/api/v1/tools/invoke`}catch{return""}});async function Nt(){try{Y.value=void 0,M.value=void 0,A.value={},R.value="";const l=JSON.parse(b.value||"{}"),e=JSON.parse(k.value||"{}"),t=performance.now(),o=await me.post("/api/v1/tools/invoke",{tenant_id:L.value,tool_type:_.value,tool_name:w.value,params:l,options:e});F.value=JSON.stringify(o.data,null,2),Y.value=o.status,M.value=Math.round(performance.now()-t),A.value=o.headers||{},Ye({params:l,options:e})}catch(l){if(me.isAxiosError(l)){const e=l.response?.status,t=l.response?.data;F.value=`AxiosError status=${e}
`+(t?JSON.stringify(t,null,2):String(l.message)),M.value=M.value??void 0,A.value=l.response&&l.response.headers||{},zt(t);try{const o=JSON.parse(b.value||"{}"),v=JSON.parse(k.value||"{}");Ye({params:o,options:v,status:e})}catch{}}else F.value=String(l?.message||l)}}function Tt(l,e){try{const t=["global","tenant","type","name","request"],o=new Set;for(const s of Object.keys(e||{}))o.add(s);for(const s of t)for(const h of Object.keys(l&&l[s]||{}))o.add(h);const v=[];for(const s of Array.from(o).sort()){const h=H(l&&l.global?l.global[s]:void 0),x=H(l&&l.tenant?l.tenant[s]:void 0),J=H(l&&l.type?l.type[s]:void 0),oe=H(l&&l.name?l.name[s]:void 0),g=H(l&&l.request?l.request[s]:void 0),ve=H(e?e[s]:void 0);let ce="global";for(const z of t)l&&l[z]&&Object.prototype.hasOwnProperty.call(l[z],s)&&(ce=z);const Yt=ce!=="global"&&t.slice(0,t.indexOf(ce)).some(z=>l&&l[z]&&Object.prototype.hasOwnProperty.call(l[z],s));v.push({key:s,global:h,tenant:x,type:J,name:oe,request:g,merged:ve,source:ce,overridden:Yt})}return v}catch{return[]}}function $t(){try{const l=JSON.parse(k.value||"{}"),e={rate_limit_per_sec:2,retry_max:1,retry_backoff_ms:200};k.value=JSON.stringify({...l,...e},null,2)}catch{}}function Jt(){try{const l=JSON.parse(k.value||"{}"),e={circuit_threshold:2,circuit_cooldown_ms:8e3};k.value=JSON.stringify({...l,...e},null,2)}catch{}}function Bt(){try{const l=JSON.parse(k.value||"{}"),e={deny_hosts:["bad.com","malicious.example"],allow_hosts:["example.com"]};k.value=JSON.stringify({...l,...e},null,2)}catch{}}function Lt(){try{b.value=JSON.stringify(JSON.parse(b.value||"{}"),null,2)}catch{}}function Ut(){try{k.value=JSON.stringify(JSON.parse(k.value||"{}"),null,2)}catch{}}function Ke(){b.value=JSON.stringify({url:"https://example.com"},null,2)}function Fe(){b.value=JSON.stringify({url:"https://httpbin.org/post",body:{hello:"world"}},null,2)}function $e(){const l={template_id:"echo_int",sql:"SELECT %(x)s::int AS x",params:{x:1},explain:!1};b.value=JSON.stringify(l,null,2),_.value="db_query",w.value="template"}function jt(){b.value=JSON.stringify({url:"https://example.com",headers:{"User-Agent":"ToolGateway/1.0","X-Debug":"1"}},null,2),_.value="http_get",w.value="simple"}function qt(){b.value=JSON.stringify({url:"https://httpbin.org/post",body:"raw text body"},null,2),_.value="http_post",w.value="simple";try{const l=JSON.parse(k.value||"{}");k.value=JSON.stringify({...l,content_type:"text/plain"},null,2)}catch{}}function Et(){b.value=JSON.stringify({url:"https://httpbin.org/post",body:{a:1,b:"x"}},null,2),_.value="http_post",w.value="simple";try{const l=JSON.parse(k.value||"{}");k.value=JSON.stringify({...l,content_type:"application/x-www-form-urlencoded"},null,2)}catch{}}function Vt(){const l={template_id:"echo_text",sql:"SELECT %(txt)s::text AS txt",params:{txt:"hello"},explain:!1};b.value=JSON.stringify(l,null,2),_.value="db_query",w.value="template"}function Rt(){const l={template_id:"select_now",sql:"SELECT NOW() as ts",params:{},explain:!1};b.value=JSON.stringify(l,null,2),_.value="db_query",w.value="template"}function Pt(){try{const l=JSON.parse(b.value||"{}");l.explain=!0,l.sql||(l.sql="SELECT %(x)s::int AS x"),l.params||(l.params={x:1}),b.value=JSON.stringify(l,null,2)}catch{$e();try{const l=JSON.parse(b.value||"{}");l.explain=!0,b.value=JSON.stringify(l,null,2)}catch{}}_.value="db_query",w.value="template"}function Mt(){const l=(_.value||"").toLowerCase();l.includes("db")?$e():l.includes("post")?Fe():Ke()}async function At(){try{const l=JSON.parse(b.value||"{}"),e=JSON.parse(k.value||"{}"),o=(await me.post("/api/v1/tools/preview",{tenant_id:L.value,tool_type:_.value,tool_name:w.value,params:l,options:e})).data||{};ke.value=JSON.stringify(o.merged_options??o.mergedOptions??o,null,2),he.value=JSON.stringify(o.layers??{},null,2),j.value=o.merged_options??{},W.value=o.layers??{},je.value=It(W.value,j.value),_e.value=Tt(W.value,j.value)}catch(l){const e=me.isAxiosError(l)&&l.response?.data?JSON.stringify(l.response.data,null,2):String(l?.message||l);ke.value=e,he.value="",j.value={},W.value={},je.value="",_e.value=[]}}function It(l,e){try{const t=["global","tenant","type","name","request"],o=new Set;for(const s of Object.keys(e||{}))o.add(s);for(const s of t){const h=l&&l[s]||{};for(const x of Object.keys(h))o.add(x)}const v=[];for(const s of Array.from(o).sort()){const h=t.map(g=>l&&l[g]&&Object.prototype.hasOwnProperty.call(l[g],s)?l[g][s]:void 0),x=e?.[s];let J="global";for(const g of t)l&&l[g]&&Object.prototype.hasOwnProperty.call(l[g],s)&&(J=g);const oe=h.slice(0,t.indexOf(J)).some(g=>g!==void 0);v.push(`${s}: merged=${JSON.stringify(x)} | source=${J}${oe?" (overrode earlier layer)":""}`)}return v.join(`
`)||"(no keys)"}catch(t){return"(diff build error) "+(t?.message||String(t))}}function H(l){if(l===void 0)return"";try{return typeof l=="string"?l:JSON.stringify(l)}catch{return String(l)}}function G(l){if(l==="")return"Undefined";try{const e=JSON.parse(l);if(e===null)return"Null";if(Array.isArray(e))return"Array";const t=typeof e;return t==="number"?"Number":t==="boolean"?"Bool":t==="string"?"String":t==="object"?"Object":t}catch{return"String"}}function Dt(){try{Je(new Blob([JSON.stringify(j.value,null,2)],{type:"application/json"}),"merged.json")}catch{}}function Qt(){try{Je(new Blob([JSON.stringify(W.value,null,2)],{type:"application/json"}),"layers.json")}catch{}}function Ht(){try{const e=[{key:"key",name:"key"},{key:"global",name:"global",cond:i.value.global},{key:"tenant",name:"tenant",cond:i.value.tenant},{key:"type",name:"type",cond:i.value.type},{key:"name",name:"name",cond:i.value.name},{key:"request",name:"request",cond:i.value.request},{key:"merged",name:"merged"},{key:"source",name:"source"},{key:"overridden",name:"overridden"}].filter(s=>s.cond===void 0||s.cond),t=e.map(s=>s.name),o=P.value.map(s=>e.map(h=>h.key==="overridden"?String(s[h.key]):s[h.key])),v=[t.join(","),...o.map(s=>s.map(Gt).join((`
`.includes(","),","))).map(s=>s)].join(`
`);Je(new Blob([v],{type:"text/csv;charset=utf-8;"}),"diff.csv")}catch{}}function Gt(l){if(l==null)return"";const e=/[",\n]/.test(l);return l.replace(/\"/g,'""').replace(/"/g,'""'),e?`"${l.replace(/"/g,'""')}"`:l}function Je(l,e){const t=URL.createObjectURL(l),o=document.createElement("a");o.href=t,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t)}function ne(l){const e=typeof l=="string"?l:String(l);if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(e);else{const t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}}function zt(l){try{const e=l&&(l.detail||l.message)||"";if(!e)return;const t=e.toLowerCase();t.includes("allow_hosts")?R.value="命中 allow_hosts 策略：请在请求 options.allow_hosts 或策略文件中添加对应主机名（仅主机名，忽略协议/端口）":t.includes("deny_hosts")?R.value="命中 deny_hosts 策略：该主机被拒绝，移除或调整策略中的 deny_hosts 配置":R.value=""}catch{R.value=""}}function Ye(l){const t=[{time:new Date().toLocaleString(),tenant_id:L.value,tool_type:_.value,tool_name:w.value,params:l.params,options:l.options,status:l.status??Y.value,durationMs:M.value},...le.value].slice(0,20);le.value=t;try{localStorage.setItem("toolsHistory",JSON.stringify(t))}catch{}}function Kt(){try{const l=localStorage.getItem("toolsHistory");l&&(le.value=JSON.parse(l))}catch{}}function Ft(l){L.value=l.tenant_id,_.value=l.tool_type,w.value=l.tool_name,b.value=JSON.stringify(l.params,null,2),k.value=JSON.stringify(l.options,null,2)}Le(Kt),Le(st),et([c,T,m,$],()=>{qe()}),Le(()=>{const l=()=>{try{if(D.value){const t=D.value.getBoundingClientRect().width;Ee.value=Math.max(200,Math.round(t)+16)}}catch{}};l(),window.addEventListener("resize",l);const e=new MutationObserver(l);D.value&&e.observe(D.value,{attributes:!0,childList:!0,subtree:!0}),Xt(()=>{window.removeEventListener("resize",l),e.disconnect()})});function We(l){const e=new Set(I.value);e.has(l)?e.delete(l):e.add(l),I.value=e}function Xe(l){try{return JSON.stringify(j.value[l],null,2)}catch{return""}}function Be(l){const e=l.toLowerCase(),t=[];return/(^|[_\.])allow(_|$)|allow_hosts|whitelist/.test(e)&&t.push("allow"),/(^|[_\.])deny(_|$)|deny_hosts|blacklist/.test(e)&&t.push("deny"),/timeout/.test(e)&&t.push("timeout"),/\brate(_limit|limit|_per_sec|persec|_per_min|permin)?\b/.test(e)&&t.push("rate"),/^retry|[_\.]retry/.test(e)&&t.push("retry"),/^circuit|[_\.]circuit|breaker/.test(e)&&t.push("circuit"),/cache/.test(e)&&t.push("cache"),/resp(_max_chars|onse|_size|size)/.test(e)&&t.push("resp"),t}function Ze(l,e){let t;try{t=JSON.parse(l.merged)}catch{t=l.merged}const o=e.split(".").filter(Boolean),v=(J,oe)=>{let g=J;for(const ve of oe){if(g==null)return;if(ve==="length"&&(typeof g=="string"||Array.isArray(g))){g=g.length;continue}g=g[ve]}return g};if(o[0]==="merged")return v(j.value,o.slice(1));const s=v(t,o);if(s!==void 0)return s;const h=v(j.value,o);if(h!==void 0)return h;const x=Number(l.merged);return Number.isNaN(x)?l.merged:x}return(l,e)=>(r(),u("section",ll,[e[76]||(e[76]=n("h2",null,"Invoke Tool",-1)),n("form",{onSubmit:Zt(Nt,["prevent"])},[n("div",null,[e[34]||(e[34]=n("label",null,"Tenant",-1)),f(n("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>L.value=t),placeholder:"default"},null,512),[[C,L.value]])]),n("div",null,[e[35]||(e[35]=n("label",null,"Type",-1)),f(n("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>_.value=t),placeholder:"http_get"},null,512),[[C,_.value]]),n("button",{type:"button",style:{"margin-left":"8px"},onClick:Mt},"按类型模板")]),n("div",null,[e[36]||(e[36]=n("label",null,"Name",-1)),f(n("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t),placeholder:"simple"},null,512),[[C,w.value]])]),n("div",null,[e[37]||(e[37]=n("label",null,"Params (JSON)",-1)),f(n("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>b.value=t),rows:"5",placeholder:'{"url":"https://example.com"}'},null,512),[[C,b.value]]),n("div",{class:"row"},[n("button",{type:"button",onClick:Lt},"格式化 Params"),n("button",{type:"button",onClick:Ke},"GET 模板"),n("button",{type:"button",onClick:Fe},"POST 模板"),n("button",{type:"button",onClick:$e},"DB 模板"),n("button",{type:"button",onClick:jt},"GET+Headers"),n("button",{type:"button",onClick:qt},"POST(Text)"),n("button",{type:"button",onClick:Et},"POST(Form)"),n("button",{type:"button",onClick:Vt},"DB echo_text"),n("button",{type:"button",onClick:Rt},"DB select_now"),n("button",{type:"button",onClick:Pt},"DB explain")])]),n("div",null,[e[38]||(e[38]=n("label",null,"Options (JSON)",-1)),f(n("textarea",{"onUpdate:modelValue":e[4]||(e[4]=t=>k.value=t),rows:"5",placeholder:'{"timeout_ms":2000, "allow_hosts":["example.com"], "deny_hosts":[]}'},null,512),[[C,k.value]]),n("div",{class:"row"},[n("button",{type:"button",onClick:Ut},"格式化 Options"),n("button",{type:"button",onClick:Bt},"deny_hosts 示例"),n("button",{type:"button",onClick:$t},"rate_limit 示例"),n("button",{type:"button",onClick:Jt},"circuit 示例")])]),e[39]||(e[39]=n("button",{type:"submit"},"Invoke",-1)),e[40]||(e[40]=n("a",{style:{"margin-left":"8px"},href:"/metrics",target:"_blank"},"/metrics",-1)),n("button",{type:"button",style:{"margin-left":"8px"},onClick:At},"预览合并策略")],32),e[77]||(e[77]=n("h3",null,"Request Preview",-1)),n("div",nl,[n("button",{type:"button",onClick:e[5]||(e[5]=t=>ne(Te.value))},"复制请求"),n("button",{type:"button",onClick:e[6]||(e[6]=t=>ne(ze.value))},"复制 cURL")]),n("pre",null,a(Te.value),1),e[78]||(e[78]=n("h3",null,"cURL",-1)),n("pre",null,a(ze.value),1),n("h3",null,[e[41]||(e[41]=O("Result ",-1)),Y.value?(r(),u("small",ol,"(status="+a(Y.value)+" duration="+a(M.value)+"ms)",1)):d("",!0)]),R.value?(r(),u("div",sl,a(R.value),1)):d("",!0),A.value&&Object.keys(A.value).length?(r(),u("div",al,[e[42]||(e[42]=n("h4",null,"Response Headers",-1)),n("pre",null,a(A.value),1)])):d("",!0),n("div",ul,[n("button",{type:"button",onClick:e[7]||(e[7]=t=>ne(F.value))},"复制结果")]),n("pre",null,a(F.value),1),e[79]||(e[79]=n("h3",null,"Merged Options",-1)),n("pre",null,a(ke.value),1),e[80]||(e[80]=n("h3",null,"Policy Layers (global/tenant/type/name/request)",-1)),n("pre",null,a(he.value),1),e[81]||(e[81]=n("h3",null,"Policy Layers Diff",-1)),n("div",rl,[e[63]||(e[63]=n("label",null,"键名过滤：",-1)),f(n("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>ae.value=t),placeholder:"输入关键字，如 allow/timeout",style:{"min-width":"240px"}},null,512),[[C,ae.value]]),n("label",null,[f(n("input",{type:"checkbox","onUpdate:modelValue":e[9]||(e[9]=t=>ue.value=t)},null,512),[[E,ue.value]]),e[43]||(e[43]=O(" 仅显示覆盖项",-1))]),n("details",null,[e[49]||(e[49]=n("summary",null,"列选择器",-1)),n("label",null,[f(n("input",{type:"checkbox","onUpdate:modelValue":e[10]||(e[10]=t=>i.value.global=t)},null,512),[[E,i.value.global]]),e[44]||(e[44]=O(" Global",-1))]),n("label",null,[f(n("input",{type:"checkbox","onUpdate:modelValue":e[11]||(e[11]=t=>i.value.tenant=t)},null,512),[[E,i.value.tenant]]),e[45]||(e[45]=O(" Tenant",-1))]),n("label",null,[f(n("input",{type:"checkbox","onUpdate:modelValue":e[12]||(e[12]=t=>i.value.type=t)},null,512),[[E,i.value.type]]),e[46]||(e[46]=O(" Type",-1))]),n("label",null,[f(n("input",{type:"checkbox","onUpdate:modelValue":e[13]||(e[13]=t=>i.value.name=t)},null,512),[[E,i.value.name]]),e[47]||(e[47]=O(" Name",-1))]),n("label",null,[f(n("input",{type:"checkbox","onUpdate:modelValue":e[14]||(e[14]=t=>i.value.request=t)},null,512),[[E,i.value.request]]),e[48]||(e[48]=O(" Request",-1))])]),n("details",null,[e[57]||(e[57]=n("summary",null,"观测链接",-1)),n("div",il,[e[50]||(e[50]=n("label",null,"Prom 基地址：",-1)),f(n("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>c.value=t),placeholder:"http://localhost:9090/graph 或 /api/v1/query",style:{"min-width":"320px"}},null,512),[[C,c.value]]),c.value&&!pe.value?(r(),u("span",pl,"无效的 URL（需 http/https）")):d("",!0),e[51]||(e[51]=n("label",null,"查询模板：",-1)),f(n("input",{"onUpdate:modelValue":e[16]||(e[16]=t=>T.value=t),style:{"min-width":"420px"}},null,512),[[C,T.value]])]),n("div",dl,[e[52]||(e[52]=n("label",null,"日志基地址：",-1)),f(n("input",{"onUpdate:modelValue":e[17]||(e[17]=t=>m.value=t),placeholder:"https://logs.example.com/search",style:{"min-width":"320px"}},null,512),[[C,m.value]]),m.value&&!de.value?(r(),u("span",vl,"无效的 URL（需 http/https）")):d("",!0),e[53]||(e[53]=n("label",null,"查询模板：",-1)),f(n("input",{"onUpdate:modelValue":e[18]||(e[18]=t=>$.value=t),placeholder:'key:"$key" AND tenant:"$tenant" AND tool:"$type.$name"',style:{"min-width":"420px"}},null,512),[[C,$.value]])]),n("div",{class:"row",style:{"margin-top":"6px"}},[n("button",{type:"button",class:"mini",onClick:at},"重置观测配置")]),n("div",cl,[n("button",{type:"button",class:"mini",onClick:ut},"导出配置"),n("button",{type:"button",class:"mini",onClick:rt},"导入配置"),n("input",{ref_key:"importInput",ref:Ae,type:"file",accept:"application/json",style:{display:"none"},onChange:it},null,544)]),n("div",yl,[e[54]||(e[54]=n("label",null,"测试键名：",-1)),f(n("input",{"onUpdate:modelValue":e[19]||(e[19]=t=>U.value=t),placeholder:"例如 timeout_ms",style:{"min-width":"200px"}},null,512),[[C,U.value]]),n("button",{type:"button",class:"mini",onClick:e[20]||(e[20]=t=>Ge("metrics")),disabled:wt.value,title:xt.value},"测试打开指标",8,ml),n("button",{type:"button",class:"mini",onClick:e[21]||(e[21]=t=>Ge("logs")),disabled:St.value,title:Ct.value},"测试打开日志",8,fl)]),n("div",bl,[e[55]||(e[55]=n("label",null,"PromQL 预览：",-1)),n("code",gl,a(De.value),1)]),n("div",kl,[e[56]||(e[56]=n("label",null,"日志查询预览：",-1)),n("code",hl,a(Qe.value),1)])]),n("details",null,[e[58]||(e[58]=n("summary",null,"预设筛选",-1)),(r(),u(V,null,K(bt,t=>n("label",{key:t,class:"preset-item"},[f(n("input",{type:"checkbox","onUpdate:modelValue":o=>re.value[t]=o},null,8,_l),[[E,re.value[t]]]),n("span",{class:"kbadge","data-type":t},a(t),9,Ol)])),64))]),e[64]||(e[64]=n("label",null,"子键排序：",-1)),f(n("input",{"onUpdate:modelValue":e[22]||(e[22]=t=>te.value=t),placeholder:"如 merged.retry_backoff_ms 或 allow_hosts.length",style:{"min-width":"300px"}},null,512),[[C,te.value]]),n("label",wl,[f(n("input",{type:"checkbox","onUpdate:modelValue":e[23]||(e[23]=t=>X.value=t)},null,512),[[E,X.value]]),e[59]||(e[59]=O(" 启用虚拟滚动",-1))]),e[65]||(e[65]=n("span",{style:{"margin-left":"8px"}},"每页",-1)),f(n("select",{"onUpdate:modelValue":e[24]||(e[24]=t=>Z.value=t)},[...e[60]||(e[60]=[n("option",{value:20},"20",-1),n("option",{value:50},"50",-1),n("option",{value:100},"100",-1),n("option",{value:200},"200",-1)])],512),[[el,Z.value,void 0,{number:!0}]]),X.value?(r(),u(V,{key:1},[e[61]||(e[61]=n("span",{style:{"margin-left":"8px"}},"高度",-1)),f(n("input",{type:"number","onUpdate:modelValue":e[25]||(e[25]=t=>se.value=t),min:"240",max:"1200",style:{width:"90px"}},null,512),[[C,se.value,void 0,{number:!0}]]),e[62]||(e[62]=O(" px ",-1)),n("span",null,"（共 "+a(P.value.length)+" 条）",1)],64)):(r(),u(V,{key:0},[n("button",{type:"button",onClick:kt,disabled:S.value<=1},"⏮",8,Sl),n("button",{type:"button",onClick:ht,disabled:S.value<=1},"◀",8,xl),n("span",null,"第 "+a(S.value)+" / "+a(ee.value)+" 页",1),n("button",{type:"button",onClick:_t,disabled:S.value>=ee.value},"▶",8,Cl),n("button",{type:"button",onClick:Ot,disabled:S.value>=ee.value},"⏭",8,Nl),n("span",null,"（"+a(we.value+1)+"-"+a(Me.value)+" / "+a(Q.value.length)+"）",1)],64)),n("button",{type:"button",onClick:Dt},"导出 merged.json"),n("button",{type:"button",onClick:Qt},"导出 layers.json"),n("button",{type:"button",onClick:Ht},"导出 diff.csv")]),Q.value.length===0?(r(),u("div",Tl,"暂无")):(r(),u("div",{key:3,class:"layers-wrap",style:ye({"--frozen-left":pt.value})},[X.value?(r(),u("div",{key:0,class:"vs-wrap",style:ye({height:se.value+"px"}),onScroll:ft,ref_key:"vsWrap",ref:dt},[n("table",$l,[n("thead",null,[n("tr",null,[n("th",{class:"col-key",ref_key:"keyCol",ref:D,onClick:e[26]||(e[26]=t=>q("key"))},[e[66]||(e[66]=O("Key ",-1)),B.value==="key"?(r(),u("span",Jl,a(N.value?"▲":"▼"),1)):d("",!0)],512),i.value.global?(r(),u("th",Bl,"Global")):d("",!0),i.value.tenant?(r(),u("th",Ll,"Tenant")):d("",!0),i.value.type?(r(),u("th",Ul,"Type")):d("",!0),i.value.name?(r(),u("th",jl,"Name")):d("",!0),i.value.request?(r(),u("th",ql,"Request")):d("",!0),n("th",{class:"col-merged",onClick:e[27]||(e[27]=t=>q("merged"))},[e[67]||(e[67]=O("Merged ",-1)),B.value==="merged"?(r(),u("span",El,a(N.value?"▲":"▼"),1)):d("",!0)]),n("th",{onClick:e[28]||(e[28]=t=>q("source"))},[e[68]||(e[68]=O("Source ",-1)),B.value==="source"?(r(),u("span",Vl,a(N.value?"▲":"▼"),1)):d("",!0)]),n("th",{onClick:e[29]||(e[29]=t=>q("overridden"))},[e[69]||(e[69]=O("Overridden ",-1)),B.value==="overridden"?(r(),u("span",Rl,a(N.value?"▲":"▼"),1)):d("",!0)]),e[70]||(e[70]=n("th",null,"Obs",-1))])]),n("tbody",null,[n("tr",Pl,[n("td",{style:ye({height:yt.value+"px",padding:0,border:0}),colspan:Pe.value},null,12,Ml)]),(r(!0),u(V,null,K(ct.value,t=>(r(),u("tr",{key:t.key,class:tt({overridden:t.overridden})},[n("td",Al,[n("div",Il,[n("code",null,a(t.key),1),(r(!0),u(V,null,K(Be(t.key),o=>(r(),u("span",{key:o,class:"kbadge","data-type":o},a(o),9,Dl))),128))])]),i.value.global?(r(),u("td",Ql,a(t.global),1)):d("",!0),i.value.tenant?(r(),u("td",Hl,a(t.tenant),1)):d("",!0),i.value.type?(r(),u("td",Gl,a(t.type),1)):d("",!0),i.value.name?(r(),u("td",zl,a(t.name),1)):d("",!0),i.value.request?(r(),u("td",Kl,a(t.request),1)):d("",!0),n("td",Fl,[n("div",Yl,[n("b",null,a(t.merged),1),n("span",Wl,a(G(t.merged)),1),n("button",{class:"mini",title:"复制 merged",onClick:o=>ne(t.merged)},"复制",8,Xl),G(t.merged)==="Array"||G(t.merged)==="Object"?(r(),u("button",{key:0,class:"mini",onClick:o=>We(t.key)},a(I.value.has(t.key)?"收起":"展开"),9,Zl)):d("",!0)]),I.value.has(t.key)?(r(),u("pre",en,a(Xe(t.key)),1)):d("",!0)]),n("td",null,[n("span",{class:"src","data-src":t.source},a(t.source),9,tn)]),n("td",null,a(t.overridden?"Yes":""),1),n("td",null,[n("button",{class:"mini",onClick:o=>ie(t,"metrics"),disabled:!c.value},"指标",8,ln),n("button",{class:"mini",onClick:o=>ie(t,"logs"),disabled:!m.value},"日志",8,nn)])],2))),128)),n("tr",on,[n("td",{style:ye({height:mt.value+"px",padding:0,border:0}),colspan:Pe.value},null,12,sn)])])])],36)):(r(),u("table",an,[n("thead",null,[n("tr",null,[n("th",{class:"col-key",ref_key:"keyCol",ref:D,onClick:e[30]||(e[30]=t=>q("key"))},[e[71]||(e[71]=O("Key ",-1)),B.value==="key"?(r(),u("span",un,a(N.value?"▲":"▼"),1)):d("",!0)],512),i.value.global?(r(),u("th",rn,"Global")):d("",!0),i.value.tenant?(r(),u("th",pn,"Tenant")):d("",!0),i.value.type?(r(),u("th",dn,"Type")):d("",!0),i.value.name?(r(),u("th",vn,"Name")):d("",!0),i.value.request?(r(),u("th",cn,"Request")):d("",!0),n("th",{class:"col-merged",onClick:e[31]||(e[31]=t=>q("merged"))},[e[72]||(e[72]=O("Merged ",-1)),B.value==="merged"?(r(),u("span",yn,a(N.value?"▲":"▼"),1)):d("",!0)]),n("th",{onClick:e[32]||(e[32]=t=>q("source"))},[e[73]||(e[73]=O("Source ",-1)),B.value==="source"?(r(),u("span",mn,a(N.value?"▲":"▼"),1)):d("",!0)]),n("th",{onClick:e[33]||(e[33]=t=>q("overridden"))},[e[74]||(e[74]=O("Overridden ",-1)),B.value==="overridden"?(r(),u("span",fn,a(N.value?"▲":"▼"),1)):d("",!0)]),e[75]||(e[75]=n("th",null,"Obs",-1))])]),n("tbody",null,[(r(!0),u(V,null,K(gt.value,t=>(r(),u("tr",{key:t.key,class:tt({overridden:t.overridden})},[n("td",bn,[n("div",gn,[n("code",null,a(t.key),1),(r(!0),u(V,null,K(Be(t.key),o=>(r(),u("span",{key:o,class:"kbadge","data-type":o},a(o),9,kn))),128))])]),i.value.global?(r(),u("td",hn,a(t.global),1)):d("",!0),i.value.tenant?(r(),u("td",_n,a(t.tenant),1)):d("",!0),i.value.type?(r(),u("td",On,a(t.type),1)):d("",!0),i.value.name?(r(),u("td",wn,a(t.name),1)):d("",!0),i.value.request?(r(),u("td",Sn,a(t.request),1)):d("",!0),n("td",xn,[n("div",Cn,[n("b",null,a(t.merged),1),n("span",Nn,a(G(t.merged)),1),n("button",{class:"mini",title:"复制 merged",onClick:o=>ne(t.merged)},"复制",8,Tn),G(t.merged)==="Array"||G(t.merged)==="Object"?(r(),u("button",{key:0,class:"mini",onClick:o=>We(t.key)},a(I.value.has(t.key)?"收起":"展开"),9,$n)):d("",!0)]),I.value.has(t.key)?(r(),u("pre",Jn,a(Xe(t.key)),1)):d("",!0)]),n("td",null,[n("span",{class:"src","data-src":t.source},a(t.source),9,Bn)]),n("td",null,a(t.overridden?"Yes":""),1),n("td",null,[n("button",{class:"mini",onClick:o=>ie(t,"metrics"),disabled:!c.value},"指标",8,Ln),n("button",{class:"mini",onClick:o=>ie(t,"logs"),disabled:!m.value},"日志",8,Un)])],2))),128))])]))],4)),e[82]||(e[82]=n("h3",null,"调用历史",-1)),le.value.length===0?(r(),u("div",jn,"暂无")):d("",!0),n("ul",null,[(r(!0),u(V,null,K(le.value,(t,o)=>(r(),u("li",{key:o},[n("code",null,a(t.time),1),n("span",null," — "+a(t.tenant_id)+"/"+a(t.tool_type)+"."+a(t.tool_name)+" — status="+a(t.status)+" duration="+a(t.durationMs)+"ms",1),n("button",{type:"button",onClick:v=>Ft(t)},"恢复",8,qn)]))),128))])]))}}),Pn=tl(En,[["__scopeId","data-v-c8ad9580"]]);export{Pn as default};
